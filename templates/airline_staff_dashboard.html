<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script>{% extends "base.html" %}
{% block title %}Airline Staff Dashboard{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Airline Staff Dashboard</h1>

    {% if staff %}
    <div class="box-item p-6 rounded-lg shadow-md mb-8">
        <h2 class="text-xl font-semibold text-gray-700 mb-3">Staff Information</h2>
        <p class="text-gray-600"><strong>Username:</strong> {{ staff.username }}</p>
        <p class="text-gray-600"><strong>Name:</strong> {{ staff.first_name }} {{ staff.last_name }}</p>
        <p class="text-gray-600"><strong>Airline:</strong> {{ staff.airline_name }}</p>
        <p class="text-gray-600"><strong>Date of Birth:</strong> {{ staff.date_of_birth.strftime('%Y-%m-%d') if staff.date_of_birth else 'N/A' }}</p>
    </div>
    {% endif %}

    <h2 class="text-xl font-semibold text-gray-800 mb-4">Flights in the Next 30 Days ({{ staff.airline_name }})</h2>
    <div class="space-y-4">
        {% if flights %}
            {% for flight in flights %}
                <div class="box-item p-4 rounded-lg shadow-md">
                    <p class="text-lg font-semibold">{{ flight.airline_name }} Flight #{{ flight.flight_num }}</p>
                    <p class="text-gray-600">{{ flight.departure_airport }} to {{ flight.arrival_airport }}</p>
                    <p class="text-gray-600">Departs: {{ flight.departure_time.strftime('%Y-%m-%d %H:%M') }} - Arrives: {{ flight.arrival_time.strftime('%Y-%m-%d %H:%M') }}</p>
                    <p class="text-gray-600">Status: <span class="font-medium 
                        {% if flight.status == 'Upcoming' %}text-blue-600
                        {% elif flight.status == 'On-time' %}text-green-600
                        {% elif flight.status == 'Delayed' %}text-yellow-600
                        {% elif flight.status == 'Cancelled' %}text-red-600
                        {% else %}text-gray-600
                        {% endif %}">{{ flight.status }}</span>
                    </p>
                    <p class="text-gray-600">Price: ${{ "%.2f"|format(flight.price) }}</p>
                    <p class="text-gray-600">Airplane ID: {{ flight.airplane_id }}</p>
                </div>
            {% endfor %}
        {% else %}
            <div class="box-item p-4 rounded-lg shadow-md">
                <p class="text-gray-600">No upcoming flights for {{ staff.airline_name }} in the next 30 days.</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Navigation Links for Airline Staff -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% if has_permission(session['username'], 'Admin') %}
        <a href="{{ url_for('create_flight') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">Create Flight</a>
        <a href="{{ url_for('add_airplane') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">Add Airplane</a>
        <a href="{{ url_for('add_airport') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">Add Airport</a>
        <a href="{{ url_for('grant_permission') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">Grant Permissions</a>
        <a href="{{ url_for('add_booking_agent') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">Add Booking Agent to Airline</a>
        {% endif %}
        {% if has_permission(session['username'], 'Operator') %}
        <a href="{{ url_for('change_status') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">Change Flight Status</a>
        <a href="{{ url_for('view_booking_agents') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">View Top Booking Agents</a>
        <a href="{{ url_for('view_frequent_customers') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">View Frequent Customers</a>
        <a href="{{ url_for('view_reports') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">View Sales Reports</a>
        <a href="{{ url_for('compare_revenue') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">Compare Revenue Sources</a>
        <a href="{{ url_for('view_top_destinations') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow text-center transition duration-150">View Top Destinations</a>
        {% endif %}    
    </div>
</div>
{% endblock %}